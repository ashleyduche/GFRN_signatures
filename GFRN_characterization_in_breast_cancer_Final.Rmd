---
title:    "Growth Factor Receptor Network (GFRN) characterization in breast cancer"
purpose:  Performs all analyses and generates figures for the Manuscript "Discrete breast cancer growth and               survival phenotypes influence apoptosis and drug response"
name:     GRFN_characterization_in_brest_cancer_Final.Rmd
authors:  Mumtahena Rahman & Shelley MacNeil
date:     18April2016,update:20April2016, update:23May2016, update:6June16

---

Load the dependencies
```{r cache=TRUE}

#Load required packages
if (!require("gplots")) {
   install.packages("gplots", dependencies = TRUE)
   library(gplots)
   }
if (!require("RColorBrewer")) {
   install.packages("RColorBrewer", dependencies = TRUE)
   library(RColorBrewer)
}
if (!require("data.table")) {
   install.packages("data.table", dependencies = TRUE)
   library(data.table)
}
if (!require("mclust")) {
   install.packages("mclust", dependencies = TRUE)
   library(mclust)
}

#souce key functions
source('Key_ASSIGN_functions_balancedsig.R', echo=TRUE)

# set colors for heatmap
my_palette <- colorRampPalette(c("darkblue","aliceblue","brown4"))(n = 299)
col_breaks = c(seq(0,0.2,length=100), seq(0.2,0.4,length=100), seq(0.4,1,length=100)) 

```

Specify input files (modify these locations for your system)
```{r}

signatures_dir <- "Datasets"

# ICBP files
icbp_gene_expression<-paste(signatures_dir,"icbp_Rsubread_tpmlog.txt",sep="/")
icbp_drug_response<-paste(signatures_dir,"ICBP_drugs.txt",sep="/")
single_pathway_best_icbp_file<-paste(signatures_dir,"optimized_single_pathway_icbp.txt",sep="/")

# TCGA files 
tcga_brca_tumor_gene_expression<-paste(signatures_dir,"PANCAN24_BRCA_1119_TPMlog2.txt",sep="/")
# downloaded from http://www.ncbi.nlm.nih.gov/geo/download/?acc=GSM1536837&format=file&file=GSM1536837%5F06%5F01%5F15%5FTCGA%5F24%2Etumor%5FRsubread%5FTPM%2Etxt%2Egz and filtered for only BRCA tumor samples
tcga_clinical<-paste(signatures_dir,"GSE62944_06_01_15_TCGA_24_548_Clinical_Variables_9264_Samples.txt",sep="/")
#downloaded from http://www.ncbi.nlm.nih.gov/geo/download/?acc=GSE62944&format=file&file=GSE62944%5F06%5F01%5F15%5FTCGA%5F24%5F548%5FClinical%5FVariables%5F9264%5FSamples%2Etxt%2Egz
tcga_brca_pam50<-paste(signatures_dir,"BRCA.547.PAM50.SigClust.Subtypes.txt",sep="/")
#downloaded from https://tcga-data.nci.nih.gov/docs/publications/brca_2012/BRCA.547.PAM50.SigClust.Subtypes.txt
single_pathway_best_tcga_file<-paste(signatures_dir,"optimized_single_pathway_tcga.txt",sep="/")

```

Read in IBCP datasets
```{r}

# ICBP Drug Response Data
drugs<-read.delim(icbp_drug_response, header=1, sep='\t',row.names=1)

# ICBP RNA-seq Data
icbp<-as.matrix(read.table(icbp_gene_expression, sep='\t', stringsAsFactors=FALSE, header=1, row.names=1))

# ICBP ASSIGN Predictions
single_pathway_best_icbp <-read.table(single_pathway_best_icbp_file,stringsAsFactors=FALSE, header=1, row.names=1,sep='\t')


# independent drug response assay (bild lab)
assay_ec50<-read.table(paste(signatures_dir,"Drug_response_assay.txt",sep="/"),header=1,row.names=1,sep='\t')

```

Read in the TCGA Datasets
```{r}

# Breast Cancer TCGA gene expression data
test<-data.frame(fread(tcga_brca_tumor_gene_expression), check.names=F,row.names=1)

#TCGA RPPA Data
prot_brca<-read.csv(paste(signatures_dir,"TCGA-BRCA-RBN.csv",sep="/"),header=1,check.names = F)

# TCGA BRCA PAM50 (intrinsic subtypes)
pam50<-read.table(tcga_brca_pam50,sep='\t', stringsAsFactors = T,header=T, row.names=1,check.names = F)

# TCGA BRCA clincal subtypes
clinicals<-data.frame(fread(tcga_clinical), check.names=F,row.names=1)

# TCGA BRCA ASSIGN generated pathway predictions (remove KRAS(Q61H))
single_pathway_best_tcga <-read.table(single_pathway_best_tcga_file,stringsAsFactors=FALSE, header=1, row.names=1,sep='\t')
```

Perform Principal Component Analysis in ICBP cell lines
```{r}

# Remove genes with low variation (filtering)
icbp_f <-icbp[apply(icbp[,1:55]==0,1,mean) < 0.85,]

# Perfrom PCA Analysis 
pca_mat_icbp <- prcomp(t(icbp_f), center=T,scale=T)
rownames(pca_mat_icbp$x)[1:7]<-gsub("X","",rownames(pca_mat_icbp$x)[1:7])

# Plot ICBP PCA Results
plot(pca_mat_icbp,main="ICBP")

#correlate the PCAs with GFRN pathway predictions from ASSIGN
icbp_pca_sig_cors=cor(pca_mat_icbp$x,single_pathway_best_icbp,method="spearman")
heatmap.2(as.matrix(icbp_pca_sig_cors[1:5,c(1,2,3,4,5,6,8)]),col=my_palette,margins = c(9,7), trace= "none", main="ICBP PC/Signature Cors")

```

Perform Principal Component Analysis in TCGA BRCA
```{r}

# Filter for low varying genes
dim(test) #23368
test_f<-test[apply(test[,1:ncol(test)]==0,1,mean) < 0.85,]
dim(test_f) #21307

# Run PCA analysis in TCGA
pca_mat <- prcomp(t(test_f), center=T,scale=T)

# Plot TCGA PCA results
plot(pca_mat,main="PCA in TCGA BRCA")

# Take the mean of all the gene expression values for all samples and correlate with the PCs 
#pdf("~/Dropbox/Multipathway_profiling_paper/Figures/PC1_avg_geneexp.pdf ")
par(mfrow=c(1,1),lwd=4)
plot(pca_mat$x[,1],(apply(test_f,2,mean)), main="Average expression vs PC1\n in TCGA samples", ylab = "Mean Gene Expression (RNA-Seq(TPMlog2)", xlab="PCA Values", )
print(cor(pca_mat$x[,1],(apply(test_f,2,mean))), method= "spearman") # -0.823
#dev.off()

```

Correlate TCGA Principal Components with ASSIGN generated GFRN pathway predictions
```{r}

#pdf("~/Dropbox/Multipathway_profiling_paper/Figures/TCGA_PCA_PC5_nokey.pdf ")
pca1_5=pca_mat$x[,1:5]
pca_pathway_cors= cor(pca1_5, single_pathway_best_tcga_nokras61, method = "spearman")

# Heatmap with signature/PC correlations 
heatmap.2(as.matrix(pca_pathway_cors),col=my_palette,main="Cor between PCs 1-5 and signatures in TCGA  \n BRCA samples", trace = "none", key=T)
#dev.off()

```

Boxplot TCGA Principal Components across clinical subtypes (IHC: ER, PR, HER2)
```{r}

# prepare data
er_pr_her2_status<-t(clinicals[c("er_status_by_ihc","pr_status_by_ihc","her2_status_by_ihc"),])
er_pr_her2_status<- er_pr_her2_status[3:nrow(er_pr_her2_status),]

# merge PCAs with IHC
com_tcga_er_pr_her2<-merge_drop(pca_mat$x,er_pr_her2_status)

# assign HER, ER, PR positive and negative
er_pos<-com_tcga_er_pr_her2[com_tcga_er_pr_her2$er_status_by_ihc=="Positive",]
er_neg<-com_tcga_er_pr_her2[com_tcga_er_pr_her2$er_status_by_ihc=="Negative",]
pr_pos<-com_tcga_er_pr_her2[com_tcga_er_pr_her2$pr_status_by_ihc=="Positive",]
pr_neg<-com_tcga_er_pr_her2[com_tcga_er_pr_her2$pr_status_by_ihc=="Negative",]
her_pos<-com_tcga_er_pr_her2[com_tcga_er_pr_her2$her2_status_by_ihc=="Positive",]
her_neg<-com_tcga_er_pr_her2[com_tcga_er_pr_her2$her2_status_by_ihc=="Negative",]

# Make boxplots for TCGA PCs across IHC subtypes
par(mfrow=c(1,1),lwd=2)
boxplot(er_pos$PC1,er_neg$PC1,pr_pos$PC1,pr_neg$PC1,her_pos$PC1,her_neg$PC1, names=c("ER+","ER-","PR+","PR-","HER2+","HER2-"), main="ER/PR/HER2 status in association with PC1", col="lightgrey", cex.axis=0.8)
boxplot(er_pos$PC2,er_neg$PC2,pr_pos$PC2,pr_neg$PC2,her_pos$PC2,her_neg$PC2, names=c("ER+","ER-","PR+","PR-","HER2+","HER2-"), main="ER/PR/HER2 status in association with PC2",col="lightgrey", cex.axis=1.6)
boxplot(er_pos$PC3,er_neg$PC3,pr_pos$PC3,pr_neg$PC3,her_pos$PC3,her_neg$PC3,top = T, names=c("ER+","ER-","PR+","PR-","HER2+","HER2-"), main="ER/PR/HER2 status in association with PC3", col="lightgrey", cex.axis=1.6)
boxplot(er_pos$PC4,er_neg$PC4,pr_pos$PC4,pr_neg$PC4,her_pos$PC4,her_neg$PC4,top = T, names=c("ER+","ER-","PR+","PR-","HER2+","HER2-"), main="ER/PR/HER2 status in association with PC4", col="lightgrey", cex.axis=1.6)
boxplot(er_pos$PC5,er_neg$PC5,pr_pos$PC5,pr_neg$PC5,her_pos$PC5,her_neg$PC5,top = T, names=c("ER+","ER-","PR+","PR-","HER2+","HER2-"), main="ER/PR/HER2 status in association with PC5", col="lightgrey", cex.axis=1.6)

```

Boxplot TCGA Principal Components across BRCA intrinsic subtypes (PAM50)
```{r}
# PCA analysis of intrinstic subtypes in TCGA BRCA

# change TCGA BRCA names from short to long
rownames(pam50)<-short_to_long_TCGA_id(longnames = colnames(test),shortnames = gsub(pattern = "\\.",replacement = "-",rownames(pam50)))
pam50_subset=subset(pam50, pam50$PAM50!="Normal")
pam50_com_tcga<-merge_drop(pca_mat$x,pam50_subset)

# boxplot for PCs in TCGA BRCA across subtypes
boxplot(pam50_com_tcga$PC1~as.matrix(pam50_com_tcga$PAM50),main="PC1 across intrinsic subtypes",cex=0.8, col="lightgrey", cex.axis=1.1)
boxplot(pam50_com_tcga$PC2~as.matrix(pam50_com_tcga$PAM50),main="PC2 across intrinsic subtypes",cex=0.8, col="lightgrey", cex.axis=1.1)
boxplot(pam50_com_tcga$PC3~as.matrix(pam50_com_tcga$PAM50),main="PC3 across intrinsic subtypes",cex=0.8, col="lightgrey", cex.axis=1.1)
boxplot(pam50_com_tcga$PC4~as.matrix(pam50_com_tcga$PAM50),main="PC4 across intrinsic subtypes",cex=0.8, col="lightgrey", cex.axis=1.1)
boxplot(pam50_com_tcga$PC5~as.matrix(pam50_com_tcga$PAM50),main="PC5 across intrinsic subtypes",cex=0.8, col="lightgrey", cex.axis=1.1)

# Check the significance of the PCs Subtypes
basal_pcs<-subset(pam50_com_tcga,PAM50=="Basal")
her2_pcs<-subset(pam50_com_tcga,PAM50=="Her2")
lumA_pcs<-subset(pam50_com_tcga,PAM50=="LumA")
lumB_pcs<-subset(pam50_com_tcga,PAM50=="LumB")
fit <- aov(pam50_com_tcga$PC1 ~ pam50_com_tcga$PAM50); summary(fit)
fit <- aov(pam50_com_tcga$PC2 ~ pam50_com_tcga$PAM50); summary(fit)
fit <- aov(pam50_com_tcga$PC3 ~ pam50_com_tcga$PAM50); summary(fit)
fit <- aov(pam50_com_tcga$PC4 ~ pam50_com_tcga$PAM50); summary(fit)
fit <- aov(pam50_com_tcga$PC5 ~ pam50_com_tcga$PAM50); summary(fit)

```

Plot GFRN pathway activity across breast cancer intrinsic subtypes (PAM50)
```{r}

#pdf("~/Dropbox/Multipathway_profiling_paper/Figures/Allpathwayf_SupFig4_noNs.pdf")
subtypes_preds<-merge(single_pathway_best_tcga_nokras61,pam50_subset,by.x = 0,by.y = 0,all.x =T)

# boxplots for GFRN activity across intrinistic subtypes
par(mfrow=c(1,1),lwd=3)
boxplot(subtypes_preds$AKT~subtypes_preds$PAM50,col=c(2,4,5,5),ylab="AKT Activity",ylim=c(0,1))
boxplot(subtypes_preds$BAD~subtypes_preds$PAM50,col=c(2,4,5,5),ylab="BAD Activity",ylim=c(0,1),las=1)
boxplot(subtypes_preds$EGFR~subtypes_preds$PAM50,col=c(2,4,5,5),ylab="EGFR Activity",ylim=c(0,1),las=1)
boxplot(subtypes_preds$HER2~subtypes_preds$PAM50,col=c(2,4,5,5),ylab="HER2 Activity",ylim=c(0,1),las=1)
boxplot(subtypes_preds$IGF1R~subtypes_preds$PAM50,col=c(2,4,5,5),ylab="IGF1R Activity",ylim=c(0,1),las=1)
boxplot(subtypes_preds$KRASG12V~subtypes_preds$PAM50,col=c(2,4,5,5),ylab="KRASG12VActivity",ylim=c(0,1),las=1)
boxplot(subtypes_preds$RAF1~subtypes_preds$PAM50,col=c(2,4,5,5,6),ylab="RAF1 Activity",ylim=c(0,1),las=1)
#dev.off()

```

Boxplot GFRN pathway activity across breast cancer clinical subtypes (IHC)
```{r}
#merge subtypes with predictions
subtypes_preds_ihc<-merge(single_pathway_best_tcga_nokras61,er_pr_her2_status,by.x = 0,by.y = 0,all.x =T)

# seperate into ER, PR, HER + and -
er_pos<-subtypes_preds_ihc[subtypes_preds_ihc$er_status_by_ihc=="Positive",]
er_neg<-subtypes_preds_ihc[subtypes_preds_ihc$er_status_by_ihc=="Negative",]
pr_pos<-subtypes_preds_ihc[subtypes_preds_ihc$pr_status_by_ihc=="Positive",]
pr_neg<-subtypes_preds_ihc[subtypes_preds_ihc$pr_status_by_ihc=="Negative",]
her_pos<-subtypes_preds_ihc[subtypes_preds_ihc$her2_status_by_ihc=="Positive",]
her_neg<-subtypes_preds_ihc[subtypes_preds_ihc$her2_status_by_ihc=="Negative",]

boxplot(er_pos$AKT,er_neg$AKT,pr_pos$AKT,pr_neg$AKT,her_pos$AKT,her_neg$AKT, names=c("ER+","ER-","PR+","PR-","HER2+","HER2-"), main="ER/PR/HER2 status in association AKT Pathway", col=c(4,4,2,2,5,5), cex.axis=1.2)
boxplot(er_pos$BAD,er_neg$BAD,pr_pos$BAD,pr_neg$BAD,her_pos$BAD,her_neg$BAD, names=c("ER+","ER-","PR+","PR-","HER2+","HER2-"), main="ER/PR/HER2 status in association BAD Pathway", col=c(4,4,2,2,5,5), cex.axis=1.2)
boxplot(er_pos$HER2,er_neg$HER2,pr_pos$HER2,pr_neg$HER2,her_pos$HER2,her_neg$HER2, names=c("ER+","ER-","PR+","PR-","HER2+","HER2-"), main="ER/PR/HER2 status in association HER2 Pathway", col=c(4,4,2,2,5,5), cex.axis=1.2)
boxplot(er_pos$IGF1R,er_neg$IGF1R,pr_pos$IGF1R,pr_neg$IGF1R,her_pos$IGF1R,her_neg$IGF1R, names=c("ER+","ER-","PR+","PR-","HER2+","HER2-"), main="ER/PR/HER2 status in association IGF1R Pathway", col=c(4,4,2,2,5,5), cex.axis=1.2)
boxplot(er_pos$EGFR,er_neg$EGFR,pr_pos$EGFR,pr_neg$EGFR,her_pos$EGFR,her_neg$EGFR, names=c("ER+","ER-","PR+","PR-","HER2+","HER2-"), main="ER/PR/HER2 status in association EGFR Pathway", col=c(4,4,2,2,5,5), cex.axis=1.2)
boxplot(er_pos$KRASG12V,er_neg$KRASG12V,pr_pos$KRASG12V,pr_neg$KRASG12V,her_pos$KRASG12V,her_neg$KRASG12V, names=c("ER+","ER-","PR+","PR-","HER2+","HER2-"), main="ER/PR/HER2 status in association KRASG12V Pathway", col=c(4,4,2,2,5,5), cex.axis=1.2)
boxplot(er_pos$RAF1,er_neg$RAF1,pr_pos$RAF1,pr_neg$RAF1,her_pos$RAF1,her_neg$RAF1, names=c("ER+","ER-","PR+","PR-","HER2+","HER2-"), main="ER/PR/HER2 status in association RAF1 Pathway", col=c(4,4,2,2,5,5), cex.axis=1.2)

# boxplot her2+ vs her2 -
boxplot(her_pos$HER2,her_neg$HER2,ylab="HER2 Activity",ylim=c(0,1),las=1,names=c("HER2 +","HER2 -"))

```

Apoptosis Figures
Make Heatmap of breat cancer bell lines from western blot 
```{r}

#parse the cell lines
selected_celllines<-c("AU565","BT474","BT483","BT549","CAMA1","HCC1143","HCC1419","HCC1428","HCC1806","HCC1937","HCC1954","HCC38","HCC70","HS578T","JIMT1","MCF7","MDAMB175","MDAMB231","T47D","ZR751")
scaled_selected<-single_pathway_best_icbp_nokras[selected_celllines,]

#make the heatmap
#pdf("~/Dropbox/Multipathway_profiling_paper/Figures/Apoptosis/heatmap_pathways_20_celllines_425_nokey.pdf")
par(mfrow=c(1,1),lwd=3)
heatmap.2(as.matrix(scale(single_pathway_best_icbp_nokras[selected_celllines,])),col=my_palette,trace="none",margins=c(7,7),main="",ColSideColors = c("coral3","aquamarine4","aquamarine4","coral3","coral3","aquamarine4","aquamarine4"), key.title="",scale="row", key=F)#,Rowv=F,Colv=F)
legend("topright",legend = c("HER2/IGF1R/AKT phenotype", "BAD/EGFR/KRAS/RAF phenotype"), col = c("coral3","aquamarine4"),  lty= 1,lwd = 10,cex = 0.5)
#dev.off()

```

Call the phenotypes in ICBP
```{r}
# scale the pathway predictions across the pathways
single_pathway_best_icbp_nokras_scaled<- scale(single_pathway_best_icbp_nokras,scale = T,center = T)
single_pathway_best_icbp_nokras_scaled=as.data.frame(single_pathway_best_icbp_nokras_scaled)

# make a space for phenotypes names
single_pathway_best_icbp_nokras_scaled$phenotype<-NA

# take the mean of the AKT, IGF1R, and HER2 = Surivial phenotype
akt_nokras<-apply(single_pathway_best_icbp_nokras_scaled[,c(1,4,5)],1,mean)
# take the mean of the EGFR, BAD, KRAS, and RAF1 = Growth phenotype
egfr_nokras<-apply(single_pathway_best_icbp_nokras_scaled[,c(2,3,6:7)],1,mean)

# Specific the phenotypes based on the mean
# (AKT Phenotype = Survival Phenotype; EGFR Phenotype= Growth Phenotype )

for(i in 1:nrow(single_pathway_best_icbp_nokras_scaled))
{ print(i)
  if(akt_nokras[[i]] > egfr_nokras[[i]]){
    single_pathway_best_icbp_nokras_scaled[i,8] <-"AKT Phenotype"
  }
  else{
    single_pathway_best_icbp_nokras_scaled[i,8] <- "EGFR Phenotype"
  }
}

colnames(single_pathway_best_icbp_nokras_scaled)[8]="woKrasQH"
#write to file
write.table(single_pathway_best_icbp_nokras_scaled,"~/Documents/PhDProjects/Multipathway_Modeling/Results/ICBP_phenotypes_woKRAS.txt",sep='\t',quote=F, col.names = NA)

#combine_icbp=merge_drop(single_pathway_best_icbp_scaled,single_pathway_best_icbp_nokras_scaled)
#combine_icbp=combine_icbp[,c(9,17)]
#single_pathway_best_icbp_nokras_scaled=as.matrix(single_pathway_best_icbp_nokras_scaled)

```

Looks for differences in gene expression for apoptosis molecules in ICBP
```{r}

# pull the genes we are intereted in (BH3 apoptosis genes)    
exp<-t(icbp[c("BAX","BAK1","BID","BCL2L11","BAD","BIK","PMAIP1","HRK","BBC3","BMF","BCL2","BCL2L1","BCL2L2","MCL1","BCL2A1"),])

#rename rownames 
rownames(exp)[1:7]<-c("184A1","184B5","21MT1","21MT2","21NT","21PT","600MPE")

# merge ICBP expression data with phenotypes 
exp_best<-merge_drop(single_pathway_best_icbp_nokras_scaled,exp)

#boxplots for ICBP gene expression for phenotypes 
#pdf("~/Dropbox/Multipathway_profiling_paper/Figures/Apoptosis/ICBP_RNAseq_BoxPlots_BH3_newColors.pdf")
par(mfrow = c(1,1), lwd=4)
for (i in 9:ncol(exp_best)) {
  tmp = t.test(exp_best[,i] ~ exp_best[,8])
  boxplot(exp_best[,i] ~ exp_best[,8],main = paste(colnames(exp_best)[i],"\np-value* =",tmp$p.value),col= c("coral3","aquamarine4"))
 
}

```

Call the phenotypes in TCGA
```{r}

# scale TCGA pathway predictions
single_pathway_best_tcga_scaled_nokras<- scale(single_pathway_best_tcga_nokras61[,1:7],scale = T,center = T)
single_pathway_best_tcga_scaled_nokras=as.data.frame(single_pathway_best_tcga_scaled_nokras)
single_pathway_best_tcga_scaled_nokras$phenotype<-NA

# take the mean of the signature groups
akt_nokras<-apply(single_pathway_best_tcga_scaled_nokras[,c(1,4,5)],1,mean)
egfr_nokras<-apply(single_pathway_best_tcga_scaled_nokras[,c(2,3,6,7)],1,mean)

for(i in 1:nrow(single_pathway_best_tcga_scaled_nokras))
{ print(i)
  if(akt_nokras[[i]] > egfr_nokras[[i]]){
    single_pathway_best_tcga_scaled_nokras[i,8] <-"AKT Phenotype"
  }
  else{
    single_pathway_best_tcga_scaled_nokras[i,8] <- "EGFR Phenotype"
  }
}

#write results to a file
colnames(single_pathway_best_tcga_scaled_nokras)[8]="noKRAS"
write.table(single_pathway_best_tcga_scaled_nokras,"~/Documents/PhDProjects/Multipathway_Modeling/Results/TCGA_phenotypes_NoKRASq.txt",sep='\t',quote=F, col.names = NA)

```

Look for protein (RPPA) expression differences between apoptosis molecules in TCGA
```{r}

# TCGA protein boxplots for phenotypes
# make TCGA names long
prot_brca$TCGA_patient_barcode<-short_to_long_TCGA_id(shortnames=gsub(pattern="\\.","-",as.character(prot_brca$TCGA_patient_barcode)),longnames=gsub(pattern="\\.","-",rownames(single_pathway_best_tcga)))

# merge protein data with pathway predictions
data_prot<-merge(single_pathway_best_tcga_scaled_nokras,prot_brca,by.x=0,by.y=1)

# pull out apoptoic proteins
prot_of_interest<-c("BAX","BAK1","BID","BIM","BAD","BIK","NOXA","HRK","PUMA","BMF","BCL2","BCLXL","BCLW","MCL1","BFL1")
colnames(data_prot)<-toupper(colnames(data_prot))
colnames(data_prot)<-gsub(pattern = "-",replacement = "",colnames(data_prot))

# Boxblot the protein expression across phenotypes
#pdf("~/Dropbox/Multipathway_profiling_paper/Figures/Apoptosis/TCGA_phenotype_protein_rppa_NewColors.pdf")
for(i in 1:length(prot_of_interest)){
  print(paste("analyzing",prot_of_interest[i]))
  if(prot_of_interest[i]%in%colnames(data_prot)){
    print(paste(prot_of_interest[i],"data available"))
    tmp<-t.test(data_prot[,prot_of_interest[i]]~data_prot$NOKRAS)
    par(lwd=4)
    boxplot(data_prot[,prot_of_interest[i]]~data_prot$NOKRAS,main=paste(prot_of_interest[i],"\np-value:",tmp$p.value,sep=' '), col= c("coral3","aquamarine4"),yaxt= 'n', ylab="RPPA Score")   
    axis(2,cex.axis=2)
  }
}
#dev.off()

```

Look for gene expression differences between apoptosis molecules in TCGA
```{r}

###TCGA gene expression based phenotype analysis
exp_tcga<-t(test[c("BAX","BAK1","BID","BCL2L11","BAD","BIK","PMAIP1","HRK","BBC3","BMF","BCL2","BCL2L1","BCL2L2","MCL1","BCL2A1"),])
#exp_best<-merge_drop(single_pathway_best_tcga,exp_tcga)
exp_best<-merge_drop(single_pathway_best_tcga_scaled_nokras,exp_tcga)

#pdf("~/Dropbox/Multipathway_profiling_paper/Figures/Apoptosis//TCGA_phenotype_gene_expression_NewColors.pdf")
# Boxplots for TCGA gene exprssion between phenotypes
par(mfrow = c(1,1), lwd=4)
for (i in 10:ncol(exp_best)) {
  tmp = t.test(exp_best[,i] ~ exp_best[,8])
  {
  boxplot(exp_best[,i] ~ exp_best[,8],main = paste(colnames(exp_best)[i],"\np-value* =",tmp$p.value),col= c("coral3","aquamarine4"))
  #boxplot(exp_best[,i] ~ exp_best[,8],main = paste(colnames(exp_best)[i],"\np-value =",tmp$p.value))
  }  
}
#dev.off()

```

Correlate ICBP GFRN pathway predictions with ICBP drug response and make Heatmap
```{r}

# Merge the ICBP GFRN pathway predictions with the ICBP drug response
colnames(drugs)[1:15]<-gsub("X","",colnames(drugs)[1:15])
pred_drug<-merge_drop(single_pathway_best_icbp_nokras_scaled,drugs,by.x = 0,by.y = 0,all.x =T)

#pdf("~/Dropbox/Multipathway_profiling_paper/drug_heatmap_nokras_2.pdf")
cors_drugs=cor(pred_drug[,c("Sigma.AKT1.2.inhibitor","CGC.11047","Cisplatin","Docetaxel","Everolimus","GSK2119563","GSK2126458","GSK1059615", "GSK1120212", "GSK1059868","GSK2141795", "PF.4691502", "Paclitaxel","Rapamycin","Temsirolimus","Erlotinib","Gefitinib","AZD6244","AG1478","Lapatinib")],pred_drug[, 1:7],method="spearman",use="pairwise")
par(lwd=2)
heatmap.2(cors_drugs, col=my_palette, trace='none', density.info = 'none', margins = c(6,6), cexCol = 0.8, main="ICBP:spearman: row scaling", RowSideColors = c("pink","yellow","yellow","yellow","pink","pink","pink","pink","lightblue", "pink","pink", "pink", "yellow","pink","pink","lightblue","lightblue","lightblue","lightblue", "pink"), scale="row",ColSideColors = c("coral3","aquamarine4","aquamarine4","coral3","coral3","aquamarine4","aquamarine4"))
legend("bottomleft",legend = c("PI3K/AKT/mTOR inhibitors", "Chemotherapeutics","EGFR/MEK inhibitors","HER2/IGF1R/AKT phenotype","BAD/EGFR/KRAS/RAF phenotype"), col = c("pink","yellow","lightblue","coral3","aquamarine4"),  lty= 1,lwd = 10,cex = 1)
#dev.off()

```

Correlate GFRN pathway predictions with drug response in an independent drug assay and make Heatmap
```{r}

# merge drug response data with GFRN pathway predictions
assay_ec50_preds<-merge_drop(assay_ec50,single_pathway_best_icbp_nokras_scaled)

#pdf("~/Dropbox/Multipathway_profiling_paper/assay_heatmap.pdf")
cors_spearman=cor(assay_ec50_preds[,c(1,2,3,4,5,7,8,9)], assay_ec50_preds[,c(10:15,16)],  method="spearman", use="pairwise")
heatmap.2(cors_spearman,margins =c(10,10), col=my_palette, trace="none",main="spearman:row scale",RowSideColors = c("pink","yellow","lightblue","pink","yellow","yellow","pink","lightblue"),ColSideColors = c("coral3","aquamarine4","aquamarine4","coral3","coral3","aquamarine4","aquamarine4"),density.info = 'none', scale="row")
#dev.off()

# boxplot and calulate p-values between the AKT and EGFR phenotype 
for(i in 1:9) {
tmp = t.test(assay_ec50_preds[, i] ~ assay_ec50_preds$woKrasQH)
boxplot(assay_ec50_preds[, i] ~ assay_ec50_preds$woKrasQH, main = paste(colnames(assay_ec50_preds)[i],"response","\np-value:",round(tmp$p.value, digits = 5),sep =' '),ylab = "Sensitivity")
  }

```


```{r echo=FALSE}
time<-format(Sys.time(),"%a %b %d %X %Y")

This analysis was run on `r time` 



```