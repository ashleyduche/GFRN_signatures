---
title: "GFRN Paper Supplemental Figure 5"
author: "David Jenkins"
date: "May 16, 2016"
output: html_document
---

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.width=6, fig.height=6}
library(ggplot2)
library(gridExtra)
library(reshape2)
library(RColorBrewer)

#Input files (Modify These to Your System's Locations)
icbp_predictions_file <- file.path("optimized_single_pathway_icbp.txt")
drug_response_file <- file.path("ICBP_drugs.txt")

#input icbp pathway data
single_pathway_best_icbp <-read.table(icbp_predictions_file, stringsAsFactors=FALSE,
                                      header=1, row.names=1,sep='\t')

drugs<-read.delim(drug_response_file, header=1, sep='\t',row.names=1)

rownames(single_pathway_best_icbp)[50] <- "T47D.Kbluc"

rownames(drugs)[38] <- "SUM1315"
rownames(drugs)[45] <- "T47D.Kbluc"
rownames(drugs)[52] <- "MDAMB175"

drugs_all <- drugs[rownames(single_pathway_best_icbp),11:100]

drugs <- drugs[rownames(single_pathway_best_icbp),c("GSK2141795","PF.4691502","Everolimus","Sigma.AKT1.2.inhibitor","GSK1059868",
                                                    "Rapamycin","Temsirolimus","GSK2126458" ,"GSK2119563","GSK1059615","Lapatinib",
                                                    "AG1478","Gefitinib","AZD6244","Erlotinib","GSK1120212","Docetaxel","CGC.11047",
                                                    "Paclitaxel","Cisplatin")]

set.seed(123)
kmeans.4 <- kmeans(scale(single_pathway_best_icbp)[,c(1,2,3,4)], 4, iter.max=100000, nstart = 100)
kmeans.4.clusters <-data.frame(kmeans.4$cluster)
kmeans.4.clusters[kmeans.4.clusters$kmeans.4.cluster == "3",] <- "Growth\nBAD low"
kmeans.4.clusters[kmeans.4.clusters$kmeans.4.cluster == "1",] <- "Growth\nBAD high"
kmeans.4.clusters[kmeans.4.clusters$kmeans.4.cluster == "4",] <- "Survival\nHER2 high"
kmeans.4.clusters[kmeans.4.clusters$kmeans.4.cluster == "2",] <- "Survival\nHER2 low"
colnames(kmeans.4.clusters) <- "KMeans.Clusters"
kmeans.4.clusters <- data.frame(kmeans.4.clusters$KMeans.Clusters, row.names = rownames(kmeans.4.clusters) )

pathway_colors <- brewer.pal(5, "Set1")[c(1,2,3,5)]

plot_drug_boxplots_final <- function(drugdata, clusters, selected, fillcolor){
  colnames(clusters) <- "clusters"
  merged <- merge(drugdata, clusters, by=0, all=T)
  merged_melt <- melt(merged, id.vars = c("Row.names", "clusters"))
  merged_melt_s <- merged_melt[merged_melt$variable == selected,]
  theplot <- ggplot(merged_melt_s, aes(factor(clusters, 
                                              levels = c("Survival\nHER2 high",
                                                         "Survival\nHER2 low",
                                                         "Growth\nBAD high",
                                                         "Growth\nBAD low")), value)) +
    geom_boxplot(outlier.shape = NA, fill=fillcolor) + 
    theme_classic() +
    theme(axis.text.x = element_text(angle = 0, hjust = 0.5),
          axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'),
          axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid')) +
    xlab("") +
    ylab("-log(EC50)") +
    geom_point(position=position_jitter(width = 0.1)) +
    ggtitle(selected) 
  return(theplot)
}

plota <- plot_drug_boxplots_final(drugs, kmeans.4.clusters, "GSK1059615", pathway_colors)
plotb <- plot_drug_boxplots_final(drugs, kmeans.4.clusters, "Lapatinib", pathway_colors)
plotc <- plot_drug_boxplots_final(drugs, kmeans.4.clusters, "AG1478", pathway_colors)
plotd <- plot_drug_boxplots_final(drugs, kmeans.4.clusters, "Gefitinib", pathway_colors)

#pdf("drug_response_boxplots.pdf", height=8)
grid.arrange(plota,plotb,plotc,plotd, nrow=2,ncol=2)
#dev.off()
```
